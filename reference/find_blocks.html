<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Test, Split, Repeat — find_blocks • manytestsr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Test, Split, Repeat — find_blocks"><meta name="description" content="Split and test."><meta property="og:description" content="Split and test."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">manytestsr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3.0000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Test, Split, Repeat</h1>

      <div class="d-none name"><code>find_blocks.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Split and test.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">find_blocks</span><span class="op">(</span></span>
<span>  <span class="va">idat</span>,</span>
<span>  <span class="va">bdat</span>,</span>
<span>  blockid <span class="op">=</span> <span class="st">"block"</span>,</span>
<span>  <span class="va">splitfn</span>,</span>
<span>  <span class="va">pfn</span>,</span>
<span>  alphafn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  local_adj_p_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  simthresh <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  sims <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  maxtest <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  thealpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  thew0 <span class="op">=</span> <span class="fl">0.05</span> <span class="op">-</span> <span class="fl">0.001</span>,</span>
<span>  fmla <span class="op">=</span> <span class="va">YContNorm</span> <span class="op">~</span> <span class="va">trtF</span> <span class="op">|</span> <span class="va">blockF</span>,</span>
<span>  parallel <span class="op">=</span> <span class="st">"multicore"</span>,</span>
<span>  ncores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  copydts <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  splitby <span class="op">=</span> <span class="st">"hwt"</span>,</span>
<span>  stop_splitby_constant <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  blocksize <span class="op">=</span> <span class="st">"hwt"</span>,</span>
<span>  return_what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blocks"</span>, <span class="st">"nodes"</span><span class="op">)</span>,</span>
<span>  trace <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-idat">idat<a class="anchor" aria-label="anchor" href="#arg-idat"></a></dt>
<dd><p>Data at the unit level.</p></dd>


<dt id="arg-bdat">bdat<a class="anchor" aria-label="anchor" href="#arg-bdat"></a></dt>
<dd><p>Data at the block level.</p></dd>


<dt id="arg-blockid">blockid<a class="anchor" aria-label="anchor" href="#arg-blockid"></a></dt>
<dd><p>A character name of the column in idat and bdat indicating the block.</p></dd>


<dt id="arg-splitfn">splitfn<a class="anchor" aria-label="anchor" href="#arg-splitfn"></a></dt>
<dd><p>A function to split the data into two pieces — using bdat</p></dd>


<dt id="arg-pfn">pfn<a class="anchor" aria-label="anchor" href="#arg-pfn"></a></dt>
<dd><p>A function to produce pvalues — using idat.</p></dd>


<dt id="arg-alphafn">alphafn<a class="anchor" aria-label="anchor" href="#arg-alphafn"></a></dt>
<dd><p>A function to adjust alpha at each step. Takes one or more
p-values plus a stratum or batch indicator. Currently alpha_investing,
alpha_saffron, alpha_addis are accepted. All of them wrap the corresponding
functions from the <code>onlineFDR</code> package.</p></dd>


<dt id="arg-local-adj-p-fn">local_adj_p_fn<a class="anchor" aria-label="anchor" href="#arg-local-adj-p-fn"></a></dt>
<dd><p>Function. A function that adjusts p-values at a node (e.g. <code>local_simes</code>).</p></dd>


<dt id="arg-simthresh">simthresh<a class="anchor" aria-label="anchor" href="#arg-simthresh"></a></dt>
<dd><p>Below which number of total observations should the p-value
functions use permutations rather than asymptotic approximations</p></dd>


<dt id="arg-sims">sims<a class="anchor" aria-label="anchor" href="#arg-sims"></a></dt>
<dd><p>Number of permutations for permutation-based testing</p></dd>


<dt id="arg-maxtest">maxtest<a class="anchor" aria-label="anchor" href="#arg-maxtest"></a></dt>
<dd><p>Maximum splits or tests to do. Should probably not be smaller than the number of experimental blocks.</p></dd>


<dt id="arg-thealpha">thealpha<a class="anchor" aria-label="anchor" href="#arg-thealpha"></a></dt>
<dd><p>Is the error rate for a given test (for cases where alphafn is NULL, or the starting alpha for alphafn not null)</p></dd>


<dt id="arg-thew-">thew0<a class="anchor" aria-label="anchor" href="#arg-thew-"></a></dt>
<dd><p>Is the starting "wealth" of the alpha investing procedure (this
is only relevant when alphafn is not null).</p></dd>


<dt id="arg-fmla">fmla<a class="anchor" aria-label="anchor" href="#arg-fmla"></a></dt>
<dd><p>A formula with outcome~treatment assignment  | block where
treatment assignment and block must be factors.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Should the pfn use multicore processing for permutation
based testing. Default is no. But could be "snow" or "multicore" following
<code>approximate</code> in the coin package.</p></dd>


<dt id="arg-ncores">ncores<a class="anchor" aria-label="anchor" href="#arg-ncores"></a></dt>
<dd><p>The number of cores used for parallel processing</p></dd>


<dt id="arg-copydts">copydts<a class="anchor" aria-label="anchor" href="#arg-copydts"></a></dt>
<dd><p>TRUE or FALSE. TRUE if using find_blocks standalone. FALSE if
copied objects are being sent to find_blocks from other functions.</p></dd>


<dt id="arg-splitby">splitby<a class="anchor" aria-label="anchor" href="#arg-splitby"></a></dt>
<dd><p>A string indicating which column in bdat contains a variable
to guide splitting (for example, a column with block sizes or block harmonic
mean weights or a column with a covariate (or a function of covariates) or a
column with a factor with levels separated by "." that indicates a
pre-specified series of splits (see splitSpecifiedFactor))</p></dd>


<dt id="arg-stop-splitby-constant">stop_splitby_constant<a class="anchor" aria-label="anchor" href="#arg-stop-splitby-constant"></a></dt>
<dd><p>TRUE if the splitting should stop when splitby
is constant within a given branch of the tree. FALSE if splitting should
continue even when splitby is constant. Default is TRUE. Different
combinations of splitby, splitfn, and stop_splitby_constant make more or
less sense as described below.</p></dd>


<dt id="arg-blocksize">blocksize<a class="anchor" aria-label="anchor" href="#arg-blocksize"></a></dt>
<dd><p>A string with the name of the column in bdat contains
information about the size of the block (or other determinant of the power
of tests within that block, such as harmonic mean weight of the block or
variance of the outcome within the block.)</p></dd>


<dt id="arg-return-what">return_what<a class="anchor" aria-label="anchor" href="#arg-return-what"></a></dt>
<dd><p>Character. Return a data.table of blocks "blocks", a
data.table of nodes "nodes", or default both c("blocks","nodes").</p></dd>


<dt id="arg-trace">trace<a class="anchor" aria-label="anchor" href="#arg-trace"></a></dt>
<dd><p>Logical, FALSE (default) to not print split number. TRUE prints the split number.</p></dd>


<dt id="arg-final-global-adj">final_global_adj<a class="anchor" aria-label="anchor" href="#arg-final-global-adj"></a></dt>
<dd><p>Character. One of <code>"none"</code>, <code>"fdr"</code>, <code>"fwer"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.table containing information about the sequence of splitting and testing</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Some notes about the splitting functions and how they relate to
splitting criteria (splitby) and stopping criteria (stop_splitby_constant).</p><ul><li><p><code><a href="splitLOO.html">splitLOO()</a></code> chooses the blocks largest on the splitby vector one at a
time so that we have two tests, one focusing on the highest ranked block and
one on all of the rest of the blocks (for example, the block with the most
units in it versus the rest of the blocks). When the splitby vector has
ties, it chooses one block at random among those tied for the first or
largest rank. When the split vector has few values, for example, only two
values, it will still split assuming that the vector is numeric (so, 1 is
ranked higher than 0) and then randomly among ties. If
stop_splitby_constant=TRUE, then the algorithm will stop after exhausting
the blocks in the higher ranked category (thinking about the binary splitby
case). For this reason we advise against using splitLOO with a factor
splitby vector with few categories. <code><a href="splitLOO.html">splitLOO()</a></code> is best used with a splitby
vector like block-size — which could be constant and thus just create a
random choice of a single block or could vary and thus focus the testing on
the largest/highest ranked blocks.</p></li>
<li><p><code><a href="splitEqualApprox.html">splitEqualApprox()</a></code> splits the sets of blocks into two groups where the
sum of the splitby vector is approximately the same in each split. For
example, if splitby is number of units in a block, then this splitting
function makes two groups of blocks, each group having the same total
number of units. This splitting function will work with discrete or factors
but will do: <code>rank_splitby &lt;- rank(splitby)</code> and then divide the blocks
into groups based on taking every other rank. So, for factors variables
with few categories that are ordered, this will allocate every other
category to one or another group.</p></li>
<li><p><code><a href="splitCluster.html">splitCluster()</a></code> splits the blocks into groups that are as similar as
possible to each other on splitby using the kmeans clustering algorithm
(using a combination of <code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans()</a></code> or <code>KMeans_rcpp()</code>). This will not work
with factor variables. When the splitting criteria is constant, it will
return random splits into roughly two equal sized groups of blocks if
stop_splitby_constant=FALSE. If stop_splitby_constant=TRUE then
<code>find_blocks()</code> will stop and return groups of blocks as detected or not.</p></li>
<li><p><code><a href="splitSpecifiedFactor.html">splitSpecifiedFactor()</a></code> will split the blocks into two groups following
prespecified pattern encoded into the labels for the levels of the factor.
For example, if we imagine three nested levels of splitting (like states,
districts, neighborhoods), the factor would have labels like
<code>category1_level1.category2_level1.category3_level1</code> and where splits will
occur from left to right depending on whether there is existing variation
at that level. When the factor is constant and stop_splitby_constant=TRUE
splitting stops. For this reason we recommend that the right-most label of
this factor be the individual blocks themselves—to ensure that testing
descends to the block level if it can. When stop_splitby_constant=FALSE,
then it uses random splits.</p></li>
<li><p><code><a href="splitSpecifiedFactorMulti.html">splitSpecifiedFactorMulti()</a></code> will split the blocks into two or more
groups following prespecified pattern encoded into the labels for the
levels of the factor. For example, if we imagine three nested levels of
splitting (like states, districts, neighborhoods), the factor would have
labels like <code>category1_level1.category2_level1.category3_level1</code> and where
splits will occur from left to right depending on whether there is existing
variation at that level. For this reason we recommend that the right-most
label of this factor be the individual blocks themselves—to ensure that
testing descends to the block level if it can. When the factor is constant
and stop_splitby_constant=TRUE splitting stops. When
stop_splitby_constant=FALSE, then it uses random splits.</p></li>
</ul></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jake Bowers.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

