<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate the error and success proportions of tests for a single iteration — calc_errs • manytestsr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate the error and success proportions of tests for a single iteration — calc_errs"><meta name="description" content="This function takes output from find_blocks or an equivalent bottom-up testing function such as adjust_block_tests
and returns the proportions of errors made. To use this function the input to find_blocks must include a column containing a true block-level effect.
Repeated uses of this function allow us to assess false discovery rates and family wise error rates among other metrics of testing success."><meta property="og:description" content="This function takes output from find_blocks or an equivalent bottom-up testing function such as adjust_block_tests
and returns the proportions of errors made. To use this function the input to find_blocks must include a column containing a true block-level effect.
Repeated uses of this function allow us to assess false discovery rates and family wise error rates among other metrics of testing success."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">manytestsr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2.7000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate the error and success proportions of tests for a single iteration</h1>

      <div class="d-none name"><code>calc_errs.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function takes output from <a href="find_blocks.html">find_blocks</a> or an equivalent bottom-up testing function such as <code>adjust_block_tests</code>
and returns the proportions of errors made. To use this function the input to find_blocks must include a column containing a true block-level effect.
Repeated uses of this function allow us to assess false discovery rates and family wise error rates among other metrics of testing success.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_errs</span><span class="op">(</span></span>
<span>  <span class="va">testobj</span>,</span>
<span>  <span class="va">truevar_name</span>,</span>
<span>  trueeffect_tol <span class="op">=</span> <span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>,</span>
<span>  blockid <span class="op">=</span> <span class="st">"bF"</span>,</span>
<span>  thealpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  fwer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_details <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-testobj">testobj<a class="anchor" aria-label="anchor" href="#arg-testobj"></a></dt>
<dd><p>Is an object arising from <code><a href="find_blocks.html">find_blocks</a></code> or <code><a href="adjust_block_tests.html">adjust_block_tests</a></code>. It will contain block-level results.</p></dd>


<dt id="arg-truevar-name">truevar_name<a class="anchor" aria-label="anchor" href="#arg-truevar-name"></a></dt>
<dd><p>Is a string indicating the name of the variable containing the true underlying causal effect (at the block level).</p></dd>


<dt id="arg-trueeffect-tol">trueeffect_tol<a class="anchor" aria-label="anchor" href="#arg-trueeffect-tol"></a></dt>
<dd><p>Is the smallest effect size below which we consider the effect to be zero (by default is it floating point zero).</p></dd>


<dt id="arg-blockid">blockid<a class="anchor" aria-label="anchor" href="#arg-blockid"></a></dt>
<dd><p>A character name of the column in idat and bdat indicating the block.</p></dd>


<dt id="arg-thealpha">thealpha<a class="anchor" aria-label="anchor" href="#arg-thealpha"></a></dt>
<dd><p>Is the error rate for a given test (for cases where alphafn is NULL, or the starting alpha for alphafn not null)</p></dd>


<dt id="arg-fwer">fwer<a class="anchor" aria-label="anchor" href="#arg-fwer"></a></dt>
<dd><p>Indicates that we are trying to control FWER. Right now, we do this by default in report_detections but this indicates when we should be looking at FDR</p></dd>


<dt id="arg-return-details">return_details<a class="anchor" aria-label="anchor" href="#arg-return-details"></a></dt>
<dd><p>TRUE means that the function should return a list of the original data ("detobj"), a summary of the results ("detresults"),  a
node level dataset  ("detnodes"), and a copy of the original object that was provided as input. Default here is FALSE. Only use TRUE when
not using simulations.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>hit</code> means that $p  $ for a given block or group of blocks where testing has stopped, <code>allnull</code> means that all of the effects in the group of blocks (or the single block) are zero, <code>anynotnull</code> means that at least one block has a non-zero effect, then this is the code that returns the different basic descriptions of errors.</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">deterrs</span> <span class="op">&lt;-</span> <span class="va">detnodes</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span> nreject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">hit</span><span class="op">)</span>,</span>
<span> naccept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hit</span><span class="op">)</span>,</span>
<span> prop_reject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">hit</span><span class="op">)</span>,</span>
<span> prop_accept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hit</span><span class="op">)</span>, <span class="co"># or 1-prop_reject</span></span>
<span> <span class="co"># rejections of false null /detections of true non-null</span></span>
<span> <span class="co"># (if any of the blocks have an effect, then we count this as a correct rejection or correct detection)</span></span>
<span> true_pos_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">hit</span> <span class="op">*</span> <span class="va">anynotnull</span><span class="op">)</span>,</span>
<span> <span class="co"># If we reject but *all* of the blocks have no effects, this is a false positive error</span></span>
<span> <span class="co"># If we reject but only one of them has no effects but the other has effects,</span></span>
<span> <span class="co"># then this is not an error --- but a correct detection</span></span>
<span> false_pos_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">hit</span> <span class="op">*</span> <span class="va">allnull</span><span class="op">)</span>,</span>
<span> <span class="co"># If we do not reject and all blocks are truly null, then we have no error.</span></span>
<span> true_neg_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hit</span><span class="op">)</span> <span class="op">*</span> <span class="va">allnull</span><span class="op">)</span>,</span>
<span> <span class="co"># If we do not reject/detect and at least one of the blocks actually has an effect, we have</span></span>
<span> <span class="co"># a false negative error --- a failure to detect the truth</span></span>
<span> false_neg_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hit</span><span class="op">)</span> <span class="op">*</span> <span class="va">anynotnull</span><span class="op">)</span>,</span>
<span> <span class="co"># Now look at false and true discoveries: false rejections as a proportion of rejections</span></span>
<span> false_disc_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">hit</span> <span class="op">*</span> <span class="va">allnull</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">hit</span><span class="op">)</span><span class="op">)</span>,</span>
<span> true_disc_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">hit</span> <span class="op">*</span> <span class="va">anynotnull</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">hit</span><span class="op">)</span><span class="op">)</span>,</span>
<span> true_nondisc_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hit</span><span class="op">)</span> <span class="op">*</span> <span class="va">allnull</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hit</span><span class="op">)</span><span class="op">)</span>,</span>
<span> false_nondisc_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hit</span><span class="op">)</span> <span class="op">*</span> <span class="va">anynotnull</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hit</span><span class="op">)</span><span class="op">)</span>,</span>
<span> meangrpsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">grpsize</span><span class="op">)</span>,</span>
<span> medgrpsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">grpsize</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">]</span></span></code></pre></div><p>We also summarize the average treatment effects in the blocks (or groups of blocks) among blocks where the null hypothesis of no effects has been rejected and where it has not been rejected.</p><ul><li><p>"nreject" Number of tests with $p  $</p></li>
<li><p>"naccept" Number of tests with $p &gt; $</p></li>
<li><p>"prop_reject" Proportion of tests with $p  $ out of all tests completed</p></li>
<li><p>"prop_accept" Proportion of tests with $p &gt; $ out of all tests completed</p></li>
<li><p>"true_pos_prop" Proportion of tests with $p  $ out of all tests of true null hypotheses (rejections of false null hypotheses)</p></li>
<li><p>"false_pos_prop" Proportion of tests with $p  $ out of all tests of false null hypotheses (rejections of true null hypotheses)</p></li>
<li><p>"true_neg_prop"</p></li>
<li><p>"false_neg_prop"</p></li>
<li><p>"false_disc_prop"</p></li>
<li><p>"true_disc_prop"</p></li>
<li><p>"true_nondisc_prop"</p></li>
<li><p>"false_nondisc_prop"</p></li>
<li><p>"meangrpsize"</p></li>
<li><p>"medgrpsize"</p></li>
<li><p>"hit1"</p></li>
<li><p>"minate1"</p></li>
<li><p>"meanate1"</p></li>
<li><p>"medate1"</p></li>
<li><p>"maxate1"</p></li>
<li><p>"hit0"</p></li>
<li><p>"minate0"</p></li>
<li><p>"meanate0"</p></li>
<li><p>"medate0"</p></li>
<li><p>"maxate0"</p></li>
</ul></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jake Bowers.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

