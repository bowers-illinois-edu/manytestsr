% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/alpha_adaptive.R
\name{alpha_adaptive_tree}
\alias{alpha_adaptive_tree}
\title{Adaptive Alpha from an Actual Tree Structure}
\usage{
alpha_adaptive_tree(node_dat, delta_hat, max_depth = NULL)
}
\arguments{
\item{node_dat}{A data.frame or data.table with columns
\code{nodenum}, \code{parent}, \code{depth}, and \code{nodesize}.
Typically extracted from a \code{\link{find_blocks}} result.
The root node must have \code{parent = 0} and \code{depth = 1}.}

\item{delta_hat}{Estimated standardized effect size (e.g., Cohen's d).
Conservative (larger) values produce more stringent adjustment,
which preserves the FWER guarantee.}

\item{max_depth}{Maximum depth to compute. Defaults to the maximum
depth present in \code{node_dat}.}
}
\value{
A function with signature
\code{function(pval, batch, nodesize, thealpha, thew0, depth)}
conforming to the \code{alphafn} interface used by
\code{\link{find_blocks}}.
}
\description{
Factory function counterpart to \code{\link{alpha_adaptive}} for
irregular trees. Creates an alpha adjustment function for use with
\code{\link{find_blocks}}, using actual per-node sample sizes to
compute the alpha schedule instead of assuming a regular k-ary tree.
}
\details{
The returned function behaves identically to the closure from
\code{\link{alpha_adaptive}}: it uses the \code{depth} parameter
to look up pre-computed alphas, ignoring \code{pval}, \code{batch},
and other arguments. The difference is that the alpha schedule comes
from \code{\link{compute_adaptive_alphas_tree}} rather than the
parametric formula, so it handles irregular branching correctly.

Results are cached internally: the alpha schedule is computed once
per unique value of \code{thealpha} and reused on subsequent calls.
}
\examples{
# Build a tree template from the DPP design
nd <- data.frame(
  nodenum  = 1:7,
  parent   = c(0, 1, 1, 2, 2, 3, 3),
  depth    = c(1, 2, 2, 3, 3, 3, 3),
  nodesize = c(500, 250, 250, 125, 125, 100, 150)
)
my_alpha <- alpha_adaptive_tree(node_dat = nd, delta_hat = 0.5)

# Use with find_blocks
# find_blocks(idat, bdat, ..., alphafn = my_alpha)

}
