<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started with manytestsr • manytestsr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="getting-started_files/libs/quarto-html/popper.min.js"></script><script src="getting-started_files/libs/quarto-html/tippy.umd.min.js"></script><link href="getting-started_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="getting-started_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with manytestsr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">manytestsr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4.1002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/advanced-methodologies.html">Advanced Statistical Methodologies in manytestsr</a></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started with manytestsr</a></li>
    <li><a class="dropdown-item" href="../articles/hierarchical-testing-workflow.html">Hierarchical Testing with manytestsr</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting Started with manytestsr</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="what-is-hierarchical-testing">What is Hierarchical Testing?<a class="anchor" aria-label="anchor" href="#what-is-hierarchical-testing"></a>
</h2>
<p>The <code>manytestsr</code> package implements hierarchical testing procedures for detecting treatment effects across multiple experimental blocks. Instead of testing each block independently (which inflates Type I error) or testing everything together (which reduces power), hierarchical testing:</p>
<ol type="1">
<li>
<strong>Splits blocks</strong> into groups based on similarity or pre-specified structure</li>
<li>
<strong>Tests groups</strong> at each level of the hierarchy<br>
</li>
<li>
<strong>Controls error rates</strong> while maintaining power to detect heterogeneous effects</li>
</ol>
<p>This is especially useful for: - Multi-site experiments with varying treatment effects - A/B tests across different user segments<br>
- Clinical trials with multiple centers - Any setting with clustered/blocked experimental units</p>
</section><section class="level2"><h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<section class="level3"><h3 id="load-package-and-data">Load Package and Data<a class="anchor" aria-label="anchor" href="#load-package-and-data"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">manytestsr</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load built-in example data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">example_dat</span>, package <span class="op">=</span> <span class="st">"manytestsr"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare individual-level data</span></span>
<span><span class="va">idat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">example_dat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create block-level summary</span></span>
<span><span class="va">bdat</span> <span class="op">&lt;-</span> <span class="va">idat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">blockF</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    nb <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,                    <span class="co"># Block size</span></span>
<span>    pb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span>,             <span class="co"># Proportion treated</span></span>
<span>    hwt <span class="op">=</span> <span class="op">(</span><span class="va">nb</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">idat</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">pb</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">pb</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># Harmonic mean weight</span></span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Data:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">idat</span><span class="op">)</span>, <span class="st">"individuals in"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bdat</span><span class="op">)</span>, <span class="st">"blocks"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Data: 1268 individuals in 44 blocks"</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="run-hierarchical-testing">Run Hierarchical Testing<a class="anchor" aria-label="anchor" href="#run-hierarchical-testing"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Basic hierarchical testing</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_blocks.html">find_blocks</a></span><span class="op">(</span></span>
<span>  idat <span class="op">=</span> <span class="va">idat</span>,                    <span class="co"># Individual-level data</span></span>
<span>  bdat <span class="op">=</span> <span class="va">bdat</span>,                    <span class="co"># Block-level data</span></span>
<span>  blockid <span class="op">=</span> <span class="st">"blockF"</span>,             <span class="co"># Block identifier column</span></span>
<span>  splitfn <span class="op">=</span> <span class="va">splitCluster</span>,         <span class="co"># How to split blocks (k-means clustering)</span></span>
<span>  pfn <span class="op">=</span> <span class="va">pOneway</span>,                  <span class="co"># Statistical test to use (t-test)</span></span>
<span>  fmla <span class="op">=</span> <span class="va">Y1</span> <span class="op">~</span> <span class="va">trtF</span> <span class="op">|</span> <span class="va">blockF</span>,     <span class="co"># Formula: outcome ~ treatment | block</span></span>
<span>  splitby <span class="op">=</span> <span class="st">"hwt"</span>,               <span class="co"># Variable to guide splitting</span></span>
<span>  parallel <span class="op">=</span> <span class="st">"no"</span>,               <span class="co"># Disable parallel processing for demo</span></span>
<span>  thealpha <span class="op">=</span> <span class="fl">0.05</span>                <span class="co"># Overall error rate</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Testing created"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">node_dat</span><span class="op">)</span>, <span class="st">"nodes in the tree"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Testing created 1 nodes in the tree"</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="find-significant-effects">Find Significant Effects<a class="anchor" aria-label="anchor" href="#find-significant-effects"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Identify blocks with significant treatment effects</span></span>
<span><span class="va">detections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/report_detections.html">report_detections</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">bdat</span>, fwer <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Results Summary:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Results Summary:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Total blocks tested:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">detections</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Total blocks tested: 44</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Blocks with significant effects:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">detections</span><span class="op">$</span><span class="va">hit</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span>  </span>
<span><span class="co">#&gt; - Blocks with significant effects: 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Detection rate:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">detections</span><span class="op">$</span><span class="va">hit</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Detection rate: 0 %</span></span>
<span></span>
<span><span class="co"># Show significant blocks if any found</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">detections</span><span class="op">$</span><span class="va">hit</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sig_blocks</span> <span class="op">&lt;-</span> <span class="va">detections</span><span class="op">[</span><span class="va">hit</span> <span class="op">==</span> <span class="cn">TRUE</span>, <span class="fu">.</span><span class="op">(</span><span class="va">blockF</span>, <span class="va">pfinalb</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nSignificant blocks:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sig_blocks</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</section></section><section class="level2"><h2 id="key-components">Key Components<a class="anchor" aria-label="anchor" href="#key-components"></a>
</h2>
<section class="level3"><h3 id="splitting-functions">Splitting Functions<a class="anchor" aria-label="anchor" href="#splitting-functions"></a>
</h3>
<p>Choose how to divide blocks at each step:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cluster-based splitting (most common)</span></span>
<span><span class="va">splitCluster</span>      <span class="co"># Groups similar blocks using k-means</span></span>
<span></span>
<span><span class="co"># Pre-specified hierarchical splitting  </span></span>
<span><span class="va">splitSpecifiedFactor</span>  <span class="co"># Follows predefined hierarchy (e.g., state &gt; district &gt; school)</span></span>
<span></span>
<span><span class="co"># Leave-one-out splitting</span></span>
<span><span class="va">splitLOO</span>          <span class="co"># Focuses on largest/most powerful blocks first</span></span>
<span></span>
<span><span class="co"># Equal-sum splitting</span></span>
<span><span class="va">splitEqualApprox</span>  <span class="co"># Balances total size/weight across groups</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="test-functions">Test Functions<a class="anchor" aria-label="anchor" href="#test-functions"></a>
</h3>
<p>Choose the statistical test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pOneway</span>       <span class="co"># T-tests (assumes normality)</span></span>
<span><span class="va">pIndepDist</span>    <span class="co"># Distance-based tests (robust, recommended)</span></span>
<span><span class="va">pWilcox</span>       <span class="co"># Wilcoxon rank-sum tests (ordinal outcomes)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="error-control">Error Control<a class="anchor" aria-label="anchor" href="#error-control"></a>
</h3>
<p>Control Type I error rates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fixed alpha (FWER control)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>alphafn <span class="ot">=</span> <span class="cn">NULL</span>, thealpha <span class="ot">=</span> <span class="fl">0.05</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sequential FDR control (more powerful)  </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>alphafn <span class="ot">=</span> alpha_investing, thealpha <span class="ot">=</span> <span class="fl">0.05</span>, thew0 <span class="ot">=</span> <span class="fl">0.049</span></span></code></pre></div>
</div>
</section></section><section class="level2"><h2 id="example-different-approaches">Example: Different Approaches<a class="anchor" aria-label="anchor" href="#example-different-approaches"></a>
</h2>
<section class="level3"><h3 id="approach-1-robust-distance-based-testing">Approach 1: Robust Distance-Based Testing<a class="anchor" aria-label="anchor" href="#approach-1-robust-distance-based-testing"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results_robust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_blocks.html">find_blocks</a></span><span class="op">(</span></span>
<span>  idat <span class="op">=</span> <span class="va">idat</span>,</span>
<span>  bdat <span class="op">=</span> <span class="va">bdat</span>,</span>
<span>  blockid <span class="op">=</span> <span class="st">"blockF"</span>,</span>
<span>  splitfn <span class="op">=</span> <span class="va">splitCluster</span>,</span>
<span>  pfn <span class="op">=</span> <span class="va">pIndepDist</span>,           <span class="co"># Distance-based test (robust)</span></span>
<span>  fmla <span class="op">=</span> <span class="va">Y1</span> <span class="op">~</span> <span class="va">trtF</span> <span class="op">|</span> <span class="va">blockF</span>,</span>
<span>  splitby <span class="op">=</span> <span class="st">"hwt"</span>,</span>
<span>  parallel <span class="op">=</span> <span class="st">"no"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">robust_detections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/report_detections.html">report_detections</a></span><span class="op">(</span><span class="va">results_robust</span><span class="op">$</span><span class="va">bdat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Robust approach detections:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">robust_detections</span><span class="op">$</span><span class="va">hit</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Robust approach detections: 8</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="approach-2-sequential-fdr-control">Approach 2: Sequential FDR Control<a class="anchor" aria-label="anchor" href="#approach-2-sequential-fdr-control"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results_fdr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_blocks.html">find_blocks</a></span><span class="op">(</span></span>
<span>  idat <span class="op">=</span> <span class="va">idat</span>,</span>
<span>  bdat <span class="op">=</span> <span class="va">bdat</span>, </span>
<span>  blockid <span class="op">=</span> <span class="st">"blockF"</span>,</span>
<span>  splitfn <span class="op">=</span> <span class="va">splitCluster</span>,</span>
<span>  pfn <span class="op">=</span> <span class="va">pIndepDist</span>,</span>
<span>  alphafn <span class="op">=</span> <span class="va">alpha_investing</span>,   <span class="co"># Sequential FDR control</span></span>
<span>  fmla <span class="op">=</span> <span class="va">Y1</span> <span class="op">~</span> <span class="va">trtF</span> <span class="op">|</span> <span class="va">blockF</span>,</span>
<span>  splitby <span class="op">=</span> <span class="st">"hwt"</span>,</span>
<span>  parallel <span class="op">=</span> <span class="st">"no"</span>,</span>
<span>  thealpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  thew0 <span class="op">=</span> <span class="fl">0.049</span>              <span class="co"># Starting "wealth"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fdr_detections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/report_detections.html">report_detections</a></span><span class="op">(</span><span class="va">results_fdr</span><span class="op">$</span><span class="va">bdat</span>, fwer <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"FDR approach detections:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fdr_detections</span><span class="op">$</span><span class="va">hit</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; FDR approach detections: 44</span></span></code></pre></div>
</div>
</section></section><section class="level2"><h2 id="visualizing-results">Visualizing Results<a class="anchor" aria-label="anchor" href="#visualizing-results"></a>
</h2>
<section class="level3"><h3 id="tree-structure">Tree Structure<a class="anchor" aria-label="anchor" href="#tree-structure"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create tree visualization</span></span>
<span><span class="va">tree_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_results_tree.html">make_results_tree</a></span><span class="op">(</span><span class="va">results</span>, block_id <span class="op">=</span> <span class="st">"blockF"</span><span class="op">)</span></span>
<span><span class="va">tree_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_results_ggraph.html">make_results_ggraph</a></span><span class="op">(</span><span class="va">tree_data</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the tree</span></span>
<span><span class="va">tree_plot</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Hierarchical Testing Tree"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="getting-started_files/figure-html/visualization-1.png" width="768"></p>
</figure>
</div>
</div>
</div>
</section><section class="level3"><h3 id="results-summary">Results Summary<a class="anchor" aria-label="anchor" href="#results-summary"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create summary table</span></span>
<span><span class="va">summary_table</span> <span class="op">&lt;-</span> <span class="va">tree_data</span><span class="op">$</span><span class="va">test_summary</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">summary_table</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">summary_table</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">summary_table</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Test Summary:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary_table</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Tree structure (nodes by depth):\n"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">tree_data</span><span class="op">$</span><span class="va">nodes</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">tree_data</span><span class="op">$</span><span class="va">nodes</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tree_data</span><span class="op">$</span><span class="va">nodes</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="va">depth</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Tree data structure available but not displayed in simple format.\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Tree structure (nodes by depth):</span></span>
<span><span class="co">#&gt;    depth     N</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:     1     1</span></span></code></pre></div>
</div>
</section></section><section class="level2"><h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<section class="level3"><h3 id="data-preparation">1. Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<ul>
<li>Ensure treatment assignment is balanced within blocks</li>
<li>Include relevant block-level covariates for splitting</li>
<li>Calculate appropriate power weights (harmonic mean weights work well)</li>
</ul></section><section class="level3"><h3 id="method-selection">2. Method Selection<a class="anchor" aria-label="anchor" href="#method-selection"></a>
</h3>
<ul>
<li>
<strong>Start with</strong>: <code>splitCluster</code> + <code>pIndepDist</code> + <code>alpha_investing</code>
</li>
<li>
<strong>For hierarchical data</strong>: Use <code>splitSpecifiedFactor</code>
</li>
<li>
<strong>For robustness</strong>: Always consider <code>pIndepDist</code>
</li>
<li>
<strong>For power</strong>: Use sequential procedures (<code>alpha_investing</code>, <code>alpha_saffron</code>)</li>
</ul></section><section class="level3"><h3 id="interpretation">3. Interpretation<a class="anchor" aria-label="anchor" href="#interpretation"></a>
</h3>
<ul>
<li>Focus on blocks identified as significant</li>
<li>Consider effect sizes, not just p-values</li>
<li>Validate findings with additional data if possible</li>
</ul></section></section><section class="level2"><h2 id="advanced-methodologies">Advanced Methodologies<a class="anchor" aria-label="anchor" href="#advanced-methodologies"></a>
</h2>
<p>The <code>manytestsr</code> package also includes state-of-the-art methodologies from leading researchers:</p>
<section class="level3"><h3 id="goemans-closed-testing">Goeman’s Closed Testing<a class="anchor" aria-label="anchor" href="#goemans-closed-testing"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Enhanced FWER control with improved power</span></span>
<span><span class="va">results_goeman</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_blocks.html">find_blocks</a></span><span class="op">(</span></span>
<span>  idat <span class="op">=</span> <span class="va">idat</span>, bdat <span class="op">=</span> <span class="va">bdat</span>,</span>
<span>  blockid <span class="op">=</span> <span class="st">"blockF"</span>, splitfn <span class="op">=</span> <span class="va">splitCluster</span>, pfn <span class="op">=</span> <span class="va">pIndepDist</span>,</span>
<span>  fmla <span class="op">=</span> <span class="va">Y1</span> <span class="op">~</span> <span class="va">trtF</span> <span class="op">|</span> <span class="va">blockF</span>, splitby <span class="op">=</span> <span class="st">"hwt"</span>, parallel <span class="op">=</span> <span class="st">"no"</span>,</span>
<span>  use_closed_testing <span class="op">=</span> <span class="cn">TRUE</span>,                    <span class="co"># Enable Goeman's method</span></span>
<span>  closed_testing_method <span class="op">=</span> <span class="st">"simes"</span>,              <span class="co"># Recommended approach</span></span>
<span>  thealpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="meinshausens-hierarchical-testing">Meinshausen’s Hierarchical Testing<a class="anchor" aria-label="anchor" href="#meinshausens-hierarchical-testing"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Hierarchical variable importance testing with sequential rejection</span></span>
<span><span class="va">results_meinshausen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_blocks.html">find_blocks</a></span><span class="op">(</span></span>
<span>  idat <span class="op">=</span> <span class="va">idat</span>, bdat <span class="op">=</span> <span class="va">bdat</span>,</span>
<span>  blockid <span class="op">=</span> <span class="st">"blockF"</span>, splitfn <span class="op">=</span> <span class="va">splitCluster</span>, pfn <span class="op">=</span> <span class="va">pIndepDist</span>,</span>
<span>  fmla <span class="op">=</span> <span class="va">Y2</span> <span class="op">~</span> <span class="va">trtF</span> <span class="op">|</span> <span class="va">blockF</span>, splitby <span class="op">=</span> <span class="st">"hwt"</span>, parallel <span class="op">=</span> <span class="st">"no"</span>,</span>
<span>  use_meinshausen <span class="op">=</span> <span class="cn">TRUE</span>,                       <span class="co"># Enable Meinshausen's method</span></span>
<span>  meinshausen_method <span class="op">=</span> <span class="st">"simes"</span>,                 <span class="co"># P-value combination</span></span>
<span>  meinshausen_sequential <span class="op">=</span> <span class="cn">TRUE</span>,                <span class="co"># Sequential rejection enhancement</span></span>
<span>  thealpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="e-values-for-sequential-testing">E-values for Sequential Testing<a class="anchor" aria-label="anchor" href="#e-values-for-sequential-testing"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Always-valid inference for sequential data collection</span></span>
<span><span class="va">results_evalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_blocks.html">find_blocks</a></span><span class="op">(</span></span>
<span>  idat <span class="op">=</span> <span class="va">idat</span>, bdat <span class="op">=</span> <span class="va">bdat</span>,</span>
<span>  blockid <span class="op">=</span> <span class="st">"blockF"</span>, splitfn <span class="op">=</span> <span class="va">splitCluster</span>, pfn <span class="op">=</span> <span class="va">pOneway</span>,</span>
<span>  fmla <span class="op">=</span> <span class="va">Y1</span> <span class="op">~</span> <span class="va">trtF</span> <span class="op">|</span> <span class="va">blockF</span>, splitby <span class="op">=</span> <span class="st">"hwt"</span>, parallel <span class="op">=</span> <span class="st">"no"</span>,</span>
<span>  use_evalues <span class="op">=</span> <span class="cn">TRUE</span>,                           <span class="co"># Enable e-value methodology</span></span>
<span>  evalue_wealth_rule <span class="op">=</span> <span class="st">"kelly"</span>,                 <span class="co"># Wealth accumulation rule</span></span>
<span>  thealpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h3>
<p>For comprehensive coverage of advanced methodologies, see the specialized vignettes: - <strong>Advanced Methodologies</strong>: Goeman, Meinshausen, Ramdas, and Rosenbaum approaches - <strong>Hierarchical Testing Workflow</strong>: Complete analysis pipelines - <strong>Design Sensitivity Analysis</strong>: Robustness to unobserved confounding</p>
<p>The hierarchical testing framework provides a principled way to navigate the multiple testing problem while maintaining power to detect heterogeneous treatment effects across experimental blocks.</p>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jake Bowers.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
